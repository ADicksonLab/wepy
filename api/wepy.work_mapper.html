
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>wepy.work_mapper package &#8212; wepy  documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="wepy.work_mapper.mapper module" href="wepy.work_mapper.mapper.html" />
    <link rel="prev" title="wepy.util.util module" href="wepy.util.util.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="wepy.work_mapper.mapper.html" title="wepy.work_mapper.mapper module"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="wepy.util.util.html" title="wepy.util.util module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">wepy  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="modules.html" >wepy</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="wepy.html" accesskey="U">wepy package</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">wepy.work_mapper package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="wepy.util.util.html"
                        title="previous chapter">wepy.util.util module</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="wepy.work_mapper.mapper.html"
                        title="next chapter">wepy.work_mapper.mapper module</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/wepy.work_mapper.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="modules.html">wepy</a></li>
              
                <li><a href="wepy.html">wepy package</a></li>
              
              <li>wepy.work_mapper package</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="module-wepy.work_mapper">
<span id="wepy-work-mapper-package"></span><h1>wepy.work_mapper package<a class="headerlink" href="#module-wepy.work_mapper" title="Permalink to this headline">¶</a></h1>
<p>Classes used for efficiently performing work at different stages of
the wepy simulation cycle.</p>
<p>Wepy simulations have four sequential stages of computation:</p>
<ol class="arabic simple">
<li><p>running segments</p></li>
<li><p>boundary conditions</p></li>
<li><p>resampling</p></li>
<li><p>reporting</p></li>
</ol>
<p>Stage 1 involves propagating dynamics for each walker in a completely
independent using the same runner function (i.e. <cite>run_segment</cite>) and
can always be completely parallelized.</p>
<p>Steps 2 and 4, with a few more assumptions of independence (which are
most likely satisfied without overly complex behavior), are probably
also completely parallelizable over walkers and reporters
respectively.</p>
<p>Resampling may also have a degree of parallelizability but will vary
considerably between resamplers and so cannot be treated outside of
any individual framework for resamplers and so will not be treated
generally in this submodule.</p>
<p>Currently, wepy supports a worker based task queue implementation
(wepy.work_mapper.mapper.WorkerMapper) for running parallel segments
in stage 1, which is very useful for utilizing GPU compute sources.
It is pretty general and utilizes the multiprocessing library for
starting worker processes. Specific code for running OpenMM GPU
calculations is contained within the openmm runner module.</p>
<p>Currently general solutions for parallelizing stage 2 and 3 are not
provided or supported in the simulation manager (to avoid premature
optimization) but these are easy targets for improving the efficiency
of wepy code.</p>
<p>If you don’t care about parallelizing your segment running (say for
simple test systems) you can use the reference implementation
(wepy.work_mapper.mapper.Mapper) which is basically just a wrapper
around a for-loop.</p>
<p>This sub-module provides reference implementations and/or abstract
base classes for a few interfaces.</p>
<p>The WorkMapper class interface has the following methods:</p>
<ul class="simple">
<li><p>init</p></li>
<li><p>cleanup</p></li>
<li><p>map</p></li>
</ul>
<p>A single attribute for the segment_function that is set at runtime
with a call to <cite>init</cite>:</p>
<ul class="simple">
<li><p>segment_func</p></li>
</ul>
<p>And an optional attribute to enable reporting on segment running performance:</p>
<ul class="simple">
<li><p>worker_segment_times : dict of int : list of float</p></li>
</ul>
<p>Which should be a dictionary mapping a worker index to a list of float
values of time (in seconds) for each task (i.e. segment of walker
dynamics) it ran in the last cycle only (not cumulative over
consecutive cycles).</p>
<p>The <cite>init</cite> method is called at runtime by the simulation manager at
the beginning of the simulation and allows for performing such actions
as opening file handles or starting worker processes (as is the case
with the WorkerMapper).</p>
<p>The only necessary key-word argument to this method is ‘segment_func’
which will be provided by the simulation manager (and is derived at
runtime from the runner).</p>
<p>The <cite>cleanup</cite> method likewise is called either at the end of a
succesful simulation or when an error occurs in the call to
<cite>run_cycle</cite> in the simulation manager (e.g. to allow killing of live
processes).</p>
<p>The <cite>map</cite> function acts similar to the python builtin except it does
not accept the function to map over the data. This is instead set
during the call to <cite>init</cite> from the ‘segment_func’ key-word argument.</p>
<p>The WorkerMapper class and related Worker and Task classes will be
provided as-is and are not really intended to be superclasses although
you are free to do so.</p>
<p>The only interfacing that facilitates their usage is that the
simulation manager will pass a required keyword argument ‘num_workers’
to the call to <cite>init</cite>.</p>
<p>See the simulation manager module to see what fields are passed to the
mappers. These will likely not be removed in the future, although more
may be added.</p>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="wepy.work_mapper.mapper.html">wepy.work_mapper.mapper module</a></li>
<li class="toctree-l1"><a class="reference internal" href="wepy.work_mapper.task_mapper.html">wepy.work_mapper.task_mapper module</a></li>
<li class="toctree-l1"><a class="reference internal" href="wepy.work_mapper.worker.html">wepy.work_mapper.worker module</a></li>
</ul>
</div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="wepy.util.util.html" title="previous chapter (use the left arrow)">wepy.util.util module</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="wepy.work_mapper.mapper.html" title="next chapter (use the right arrow)">wepy.work_mapper.mapper module</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="wepy.work_mapper.mapper.html" title="wepy.work_mapper.mapper module"
             >next</a> |</li>
        <li class="right" >
          <a href="wepy.util.util.html" title="wepy.util.util module"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">wepy  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="modules.html" >wepy</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="wepy.html" >wepy package</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018, Samuel D. Lotz. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>