<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Setting Up the Simulation &#8212; Wepy Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=77553476" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=c058f7c8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=b1d2a1f0" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=4f057836" />
    <script src="../../../_static/documentation_options.js?v=fc837d61"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://adicksonlab.github.io/wepy/_source/quick_start/setting_up_simulation/README.html" />
    <link rel="icon" href="../../../_static/wepy-icon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="More on Reporters" href="../reporters/README.html" />
    <link rel="prev" title="Quick Start" href="../index.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="../index.html" title="Previous document">Quick Start</a>
        </li>
        <li>
          <a href="../reporters/README.html" title="Next document">More on Reporters</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="setting-up-the-simulation">
<h1>Setting Up the Simulation<a class="headerlink" href="#setting-up-the-simulation" title="Link to this heading">¶</a></h1>
<p>If you just want to poke Wepy with a stick to see if the dang thing
works we have the script for you!</p>
<p>While this script uses a very simple system, it is a pretty good
introduction to the inputs and kind of results you can expect from Wepy
simulations.</p>
<p>Just make a new directory where you want your results to be placed
(anywhere on your filesystem) and then copy the commands below into a
python script saved in that directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>test_drive
<span class="nb">cd</span><span class="w"> </span>test_drive
</pre></div>
</div>
<p>This script can also be found in the Wepy repository in the
examples/test<sub>drive</sub> folder.</p>
<p>This code runs a simulation of a pair of particles that is created using
the <code class="docutils literal notranslate"><span class="pre">test_system_builder</span></code> module from Wepy. This will build a system
with one Na<sup>+</sup> and one Cl<sup>-</sup> atom. We will use 10 walkers,
and run 5 cycles of dynamics and resampling, where each round of
dynamics lasts for 2 picoseconds (τ = 2 ps in the WE terminology). This
example uses the <code class="docutils literal notranslate"><span class="pre">NoResampler</span></code> which performs no resampling so this is
equivalent to running 10 simulations in parallel. More details on
resampling will be given in later sections.</p>
<p>We first start by intializing our simulation system and importing the
required packages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="kn">import</span> <span class="nn">openmm</span> <span class="k">as</span> <span class="nn">omm</span>
<span class="kn">import</span> <span class="nn">openmm.unit</span> <span class="k">as</span> <span class="nn">unit</span>

<span class="kn">from</span> <span class="nn">wepy.util.test_system_builder</span> <span class="kn">import</span> <span class="n">NaClPair</span>
<span class="kn">from</span> <span class="nn">wepy.util.mdtraj</span> <span class="kn">import</span> <span class="n">mdtraj_to_json_topology</span>

<span class="kn">from</span> <span class="nn">wepy.resampling.resamplers.resampler</span> <span class="kn">import</span> <span class="n">NoResampler</span>
<span class="kn">from</span> <span class="nn">wepy.runners.openmm</span> <span class="kn">import</span> <span class="n">OpenMMRunner</span><span class="p">,</span> <span class="n">gen_walker_state</span>
<span class="kn">from</span> <span class="nn">wepy.walker</span> <span class="kn">import</span> <span class="n">Walker</span>
<span class="kn">from</span> <span class="nn">wepy.sim_manager</span> <span class="kn">import</span> <span class="n">Manager</span>

<span class="kn">from</span> <span class="nn">wepy.reporter.dashboard</span> <span class="kn">import</span> <span class="n">DashboardReporter</span>
<span class="kn">from</span> <span class="nn">wepy.reporter.openmm</span> <span class="kn">import</span> <span class="n">OpenMMRunnerDashboardSection</span>


<span class="c1"># number of cycles of sampling to perform</span>
<span class="n">n_cycles</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># number of steps in each dynamics run</span>
<span class="n">n_steps</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_steps</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cycles</span><span class="p">)]</span>
<span class="c1"># number of parallel simulations to run</span>
<span class="n">n_walkers</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># use a ready made system for OpenMM MD simulation</span>
<span class="n">test_sys</span> <span class="o">=</span> <span class="n">NaClPair</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Now that we have a system, we will continue by creating the core
components of a wepy simulation:</p>
<ul>
<li><p><strong>Runner</strong>: for running dynamics.</p></li>
<li><p><strong>Resampler</strong>: for performing resampling (i.e. cloning and merging
of walkers using the WE algorithm).</p></li>
<li><p><strong>Manager</strong>: for executing the main simulation loop.</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test_mdj_topology</span> <span class="o">=</span> <span class="n">test_sys</span><span class="o">.</span><span class="n">mdtraj_topology</span>
<span class="n">json_top</span> <span class="o">=</span> <span class="n">mdtraj_to_json_topology</span><span class="p">(</span><span class="n">test_mdj_topology</span><span class="p">)</span>

<span class="n">integrator</span> <span class="o">=</span> <span class="n">omm</span><span class="o">.</span><span class="n">LangevinIntegrator</span><span class="p">(</span><span class="mf">300.0</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span>
                                    <span class="mi">1</span><span class="o">/</span><span class="n">unit</span><span class="o">.</span><span class="n">picosecond</span><span class="p">,</span>
                                    <span class="mf">0.002</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">)</span>

<span class="n">init_state</span> <span class="o">=</span> <span class="n">gen_walker_state</span><span class="p">(</span><span class="n">test_sys</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="n">test_sys</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
<span class="c1"># create the initial walkers with equal weights</span>
<span class="n">init_weight</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">n_walkers</span>
<span class="n">init_walkers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Walker</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">init_state</span><span class="p">),</span> <span class="n">init_weight</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_walkers</span><span class="p">)]</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">OpenMMRunner</span><span class="p">(</span><span class="n">test_sys</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">test_sys</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">integrator</span><span class="p">,</span>
                    <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;Reference&#39;</span><span class="p">)</span>

<span class="c1"># a trivial resampler which does nothing</span>
<span class="n">resampler</span> <span class="o">=</span> <span class="n">NoResampler</span><span class="p">()</span>
</pre></div>
</div>
<p>We are almost there, all we need is to create the reporter where we will
store the results of the simulation. Then we are ready to run!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the dashboard reporter</span>
<span class="n">dashboard_path</span> <span class="o">=</span> <span class="s1">&#39;wepy.dash.org&#39;</span>
<span class="n">openmm_dashboard_sec</span> <span class="o">=</span> <span class="n">OpenMMRunnerDashboardSection</span><span class="p">(</span><span class="n">runner</span><span class="p">)</span>
<span class="n">dashboard_reporter</span> <span class="o">=</span> <span class="n">DashboardReporter</span><span class="p">(</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">dashboard_path</span><span class="p">,</span>
                                    <span class="n">runner_dash</span> <span class="o">=</span> <span class="n">openmm_dashboard_sec</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can start our simulation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sim_manager</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">(</span><span class="n">init_walkers</span><span class="p">,</span>
                    <span class="n">runner</span><span class="o">=</span><span class="n">runner</span><span class="p">,</span>
                    <span class="n">resampler</span><span class="o">=</span><span class="n">resampler</span><span class="p">,</span>
                    <span class="n">reporters</span><span class="o">=</span><span class="p">[</span><span class="n">dashboard_reporter</span><span class="p">]</span>
                    <span class="p">)</span>

<span class="c1"># run the simulation and get the results</span>
<span class="n">final_walkers</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sim_manager</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">(</span><span class="n">n_cycles</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
</pre></div>
</div>
<p>You can run this wepy simulation by running this on the command line
after you have copied it to a file (named, say, <code class="docutils literal notranslate"><span class="pre">wepy_script.py</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>wepy_script.py
</pre></div>
</div>
<p>After running the simulation you should see one file appear in your
directory: wepy.dash.org. This is a text file that can be opened with
emacs, or any other text editor. It contains a multitude of information
about the progress of the simulation, the timings of the trajectory
segments and can be extended to include other information as well.</p>
<p>Wepy is extremely customizable and just about any component can be
changed to match your needs. For now we just show you one of the
simplest possible examples of running wepy using OpenMM to give you a
flavor of how this looks like. In the following sections, we will go
into more detail about using a resampler and reporters which will be
essential for restarting/continuing a simulation.</p>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="../index.html" title="Previous document">Quick Start</a>
        </li>
        <li>
          <a href="../reporters/README.html" title="Next document">More on Reporters</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/wepy.svg" alt="Logo" />
    
    <h1 class="logo logo-name">wepy</h1>
    
  </a>
</p>



<p class="blurb">Wepy Documentation</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=ADicksonLab&repo=wepy&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction &amp; Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Quick Start</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">HDF5 Reporter Data Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../general_info.html">General Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../news.html">News and Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide.html">Development Guide</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Quick Start</a><ul>
      <li>Previous: <a href="../index.html" title="previous chapter">Quick Start</a></li>
      <li>Next: <a href="../reporters/README.html" title="next chapter">More on Reporters</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Michigan State University.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../../_sources/_source/quick_start/setting_up_simulation/README.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>