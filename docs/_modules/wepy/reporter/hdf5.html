
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>wepy.reporter.hdf5 &#8212; wepy v0.10 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for wepy.reporter.hdf5</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">wepy.reporter.reporter</span> <span class="k">import</span> <span class="n">FileReporter</span>
<span class="kn">from</span> <span class="nn">wepy.hdf5</span> <span class="k">import</span> <span class="n">WepyHDF5</span>
<span class="kn">from</span> <span class="nn">wepy.util.util</span> <span class="k">import</span> <span class="n">json_top_atom_count</span>
<div class="viewcode-block" id="WepyHDF5Reporter"><a class="viewcode-back" href="../../../api/wepy.reporter.html#wepy.reporter.hdf5.WepyHDF5Reporter">[docs]</a><span class="k">class</span> <span class="nc">WepyHDF5Reporter</span><span class="p">(</span><span class="n">FileReporter</span><span class="p">):</span>

    <span class="c1"># this is the name of the dataset that the all atoms will be saved</span>
    <span class="c1"># under in the HDF5 alt_reps group</span>
    <span class="n">ALL_ATOMS_REP_KEY</span> <span class="o">=</span> <span class="s1">&#39;all_atoms&#39;</span>

    <span class="n">FILE_ORDER</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;wepy_hdf5_path&#39;</span><span class="p">,)</span>

    <span class="c1"># this is the suggested extension for naming WepyHDF5 files used</span>
    <span class="c1"># by this reporter, e.g. results.wepy.h5</span>
    <span class="n">SUGGESTED_EXTENSIONS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;wepy.h5&#39;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">save_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">topology</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sparse_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">feature_shapes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">n_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">main_rep_idxs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">all_atoms_rep_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="c1"># dictionary of alt_rep keys and a tuple of (idxs, freq)</span>
                 <span class="n">alt_reps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>

                 <span class="c1"># pass in the resampler and boundary</span>
                 <span class="c1"># conditions classes to automatically extract the</span>
                 <span class="c1"># needed data, the objects themselves are not saves</span>
                 <span class="n">resampler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">boundary_conditions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>

                 <span class="c1"># or pass the things we need from them in manually</span>
                 <span class="n">resampling_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">decision_enum_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">resampler_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">warping_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">progress_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">bc_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>

                 <span class="n">resampling_records</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">resampler_records</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">warping_records</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">bc_records</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">progress_records</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>

                 <span class="o">**</span><span class="n">kwargs</span>
                 <span class="p">):</span>

        <span class="c1"># initialize inherited attributes</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># do all the WepyHDF5 specific stuff</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_topology</span> <span class="o">=</span> <span class="n">topology</span>
        <span class="c1"># which fields from the walker to save, if None then save all of them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_fields</span> <span class="o">=</span> <span class="n">save_fields</span>
        <span class="c1"># dictionary of sparse_field_name -&gt; int : frequency of cycles</span>
        <span class="c1"># to save the field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sparse_fields</span> <span class="o">=</span> <span class="n">sparse_fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feature_shapes</span> <span class="o">=</span> <span class="n">feature_shapes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feature_dtypes</span> <span class="o">=</span> <span class="n">feature_dtypes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_dims</span> <span class="o">=</span> <span class="n">n_dims</span>

        <span class="c1"># get and set the record fields (naems, shapes, dtypes) for</span>
        <span class="c1"># the resampler and the boundary conditions</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">resampling_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">decision_enum_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampling_fields</span> <span class="o">=</span> <span class="n">resampling_fields</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decision_enum</span> <span class="o">=</span> <span class="n">decision_enum_dict</span>
        <span class="k">elif</span> <span class="n">resampler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampling_fields</span> <span class="o">=</span> <span class="n">resampler</span><span class="o">.</span><span class="n">resampling_fields</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decision_enum</span> <span class="o">=</span> <span class="n">resampler</span><span class="o">.</span><span class="n">DECISION</span><span class="o">.</span><span class="n">enum_dict_by_name</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampling_fields</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decision_enum</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">resampler_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampler_fields</span> <span class="o">=</span> <span class="n">resampler_fields</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">resampler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampler_fields</span> <span class="o">=</span> <span class="n">resampler</span><span class="o">.</span><span class="n">resampler_fields</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampler_fields</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">warping_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warping_fields</span> <span class="o">=</span> <span class="n">warping_fields</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">boundary_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warping_fields</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="o">.</span><span class="n">warping_fields</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warping_fields</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">progress_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_fields</span> <span class="o">=</span> <span class="n">progress_fields</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">boundary_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_fields</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="o">.</span><span class="n">progress_fields</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_fields</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">bc_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bc_fields</span> <span class="o">=</span> <span class="n">bc_fields</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">boundary_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bc_fields</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="o">.</span><span class="n">bc_fields</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bc_fields</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="c1"># the fields which are records for table like reports</span>
        <span class="k">if</span> <span class="n">resampling_records</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampling_records</span> <span class="o">=</span> <span class="n">resampling_records</span>
        <span class="k">elif</span> <span class="n">resampler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampling_records</span> <span class="o">=</span> <span class="n">resampler</span><span class="o">.</span><span class="n">resampling_record_field_names</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampling_records</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">resampler_records</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampler_records</span> <span class="o">=</span> <span class="n">resampler_records</span>
        <span class="k">elif</span> <span class="n">resampler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampler_records</span> <span class="o">=</span> <span class="n">resampler</span><span class="o">.</span><span class="n">resampler_record_field_names</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampler_records</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">bc_records</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bc_records</span> <span class="o">=</span> <span class="n">bc_records</span>
        <span class="k">elif</span> <span class="n">boundary_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bc_records</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="o">.</span><span class="n">bc_record_field_names</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bc_records</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">warping_records</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warping_records</span> <span class="o">=</span> <span class="n">warping_records</span>
        <span class="k">elif</span> <span class="n">boundary_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warping_records</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="o">.</span><span class="n">warping_record_field_names</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warping_records</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">progress_records</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_records</span> <span class="o">=</span> <span class="n">progress_records</span>
        <span class="k">elif</span> <span class="n">boundary_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_records</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="o">.</span><span class="n">progress_record_field_names</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_records</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="c1"># the atom indices of the whole system that will be saved as</span>
        <span class="c1"># the main positions representation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_rep_idxs</span> <span class="o">=</span> <span class="n">main_rep_idxs</span>

        <span class="c1"># the idxs for alternate representations of the system</span>
        <span class="c1"># positions</span>
        <span class="k">if</span> <span class="n">alt_reps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_reps_idxs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">alt_reps</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

            <span class="c1"># add the frequencies for these alt_reps to the</span>
            <span class="c1"># sparse_fields frequency dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sparse_fields</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;alt_reps/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">tup</span>
                                       <span class="ow">in</span> <span class="n">alt_reps</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_reps_idxs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># check for alt_reps of this name because this is reserved for</span>
        <span class="c1"># the all_atoms flag.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_ATOMS_REP_KEY</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_reps_idxs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot name an alt_rep &#39;all_atoms&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># if there is a frequency for all atoms rep then we make an</span>
        <span class="c1"># alt_rep for the all_atoms system with the specified</span>
        <span class="c1"># frequency</span>
        <span class="k">if</span> <span class="n">all_atoms_rep_freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># count the number of atoms in the topology and set the</span>
            <span class="c1"># alt_reps to have the full slice for all atoms</span>
            <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">json_top_atom_count</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tmp_topology</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt_reps_idxs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ALL_ATOMS_REP_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">)</span>
            <span class="c1"># add the frequency for this sparse fields to the</span>
            <span class="c1"># sparse fields dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sparse_fields</span><span class="p">[</span><span class="s2">&quot;alt_reps/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ALL_ATOMS_REP_KEY</span><span class="p">)]</span> <span class="o">=</span> <span class="n">all_atoms_rep_freq</span>

        <span class="c1"># if there are no sparse fields set it as an empty dictionary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sparse_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sparse_fields</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># if units were given add them otherwise set as an empty dictionary</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>


<div class="viewcode-block" id="WepyHDF5Reporter.init"><a class="viewcode-back" href="../../../api/wepy.reporter.html#wepy.reporter.hdf5.WepyHDF5Reporter.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continue_run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># do the inherited stuff</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># open and initialize the HDF5 file</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span> <span class="o">=</span> <span class="n">WepyHDF5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
                                <span class="n">topology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tmp_topology</span><span class="p">,</span>
                                <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                <span class="n">sparse_fields</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sparse_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                <span class="n">feature_shapes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_shapes</span><span class="p">,</span>
                                <span class="n">feature_dtypes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_dtypes</span><span class="p">,</span>
                                <span class="n">n_dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_dims</span><span class="p">,</span>
                                <span class="n">main_rep_idxs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_rep_idxs</span><span class="p">,</span>
                                <span class="n">alt_reps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alt_reps_idxs</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="p">:</span>

            <span class="c1"># if this is a continuation run of another run we want to</span>
            <span class="c1"># initialize it as such</span>

            <span class="c1"># initialize a new run</span>
            <span class="n">run_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">new_run</span><span class="p">(</span><span class="n">continue_run</span><span class="o">=</span><span class="n">continue_run</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span> <span class="o">=</span> <span class="n">run_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;run_idx&#39;</span><span class="p">]</span>

            <span class="c1"># initialize the run record groups using their fields</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_run_fields_resampling</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resampling_fields</span><span class="p">)</span>
            <span class="c1"># the enumeration for the values of resampling</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_run_fields_resampling_decision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decision_enum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_run_fields_resampler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resampler_fields</span><span class="p">)</span>
            <span class="c1"># set the fields that are records for tables etc. unless</span>
            <span class="c1"># they are already set</span>
            <span class="k">if</span> <span class="s1">&#39;resampling&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">record_fields</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_record_fields</span><span class="p">(</span><span class="s1">&#39;resampling&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resampling_records</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;resampler&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">record_fields</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_record_fields</span><span class="p">(</span><span class="s1">&#39;resampler&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resampler_records</span><span class="p">)</span>

            <span class="c1"># if there were no warping fields set there is no boundary</span>
            <span class="c1"># conditions and we don&#39;t initialize them</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warping_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_run_fields_warping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">warping_fields</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_run_fields_progress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_fields</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_run_fields_bc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_fields</span><span class="p">)</span>
                <span class="c1"># table records</span>
                <span class="k">if</span> <span class="s1">&#39;warping&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">record_fields</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_record_fields</span><span class="p">(</span><span class="s1">&#39;warping&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">warping_records</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;boundary_conditions&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">record_fields</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_record_fields</span><span class="p">(</span><span class="s1">&#39;boundary_conditions&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_records</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;progress&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">record_fields</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">init_record_fields</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_records</span><span class="p">)</span>

        <span class="c1"># if this was opened in a truncation mode, we don&#39;t want to</span>
        <span class="c1"># overwrite old runs with future calls to init(). so we</span>
        <span class="c1"># change the mode to read/write &#39;r+&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="WepyHDF5Reporter.cleanup"><a class="viewcode-back" href="../../../api/wepy.reporter.html#wepy.reporter.hdf5.WepyHDF5Reporter.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>


        <span class="c1"># it should be already closed at this point but just in case</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># remove reference to the WepyHDF5 file so we can serialize this object</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cleanup</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="WepyHDF5Reporter.report"><a class="viewcode-back" href="../../../api/wepy.reporter.html#wepy.reporter.hdf5.WepyHDF5Reporter.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_walkers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">cycle_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">warp_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">bc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">progress_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">resampling_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">resampler_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">n_walkers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_walkers</span><span class="p">)</span>

        <span class="c1"># determine which fields to save. If there were none specified</span>
        <span class="c1"># save all of them</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_walkers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_fields</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="p">:</span>

            <span class="c1"># add trajectory data for the walkers</span>
            <span class="k">for</span> <span class="n">walker_idx</span><span class="p">,</span> <span class="n">walker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_walkers</span><span class="p">):</span>

                <span class="n">walker</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">walker</span><span class="p">)</span>
                <span class="n">walker_data</span> <span class="o">=</span> <span class="n">walker</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>

                <span class="c1"># iterate through the feature vectors of the walker</span>
                <span class="c1"># (fields), and the keys for the alt_reps</span>
                <span class="k">for</span> <span class="n">field_path</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">walker_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>

                    <span class="c1"># save the field if it is in the list of save_fields</span>
                    <span class="k">if</span> <span class="n">field_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">save_fields</span><span class="p">:</span>
                        <span class="n">walker_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field_path</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="c1"># if the result is None don&#39;t save anything</span>
                    <span class="k">if</span> <span class="n">walker_data</span><span class="p">[</span><span class="n">field_path</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">walker_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field_path</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="c1"># if this is a sparse field we decide</span>
                    <span class="c1"># whether it is a valid cycle to save on</span>
                    <span class="k">if</span> <span class="n">field_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sparse_fields</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cycle_idx</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sparse_fields</span><span class="p">[</span><span class="n">field_path</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1"># this is not a valid cycle so we</span>
                            <span class="c1"># remove from the walker_data</span>
                            <span class="n">walker_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field_path</span><span class="p">)</span>
                            <span class="k">continue</span>


                <span class="c1"># Add the alt_reps fields by slicing the positions</span>
                <span class="k">for</span> <span class="n">alt_rep_key</span><span class="p">,</span> <span class="n">alt_rep_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt_reps_idxs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">alt_rep_path</span> <span class="o">=</span> <span class="s2">&quot;alt_reps/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alt_rep_key</span><span class="p">)</span>
                    <span class="c1"># check to make sure this is a cycle this is to be</span>
                    <span class="c1"># saved to, if it is add it to the walker_data</span>
                    <span class="k">if</span> <span class="n">cycle_idx</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sparse_fields</span><span class="p">[</span><span class="n">alt_rep_path</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># if the idxs are None we want all of the atoms</span>
                        <span class="k">if</span> <span class="n">alt_rep_idxs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">alt_rep_data</span> <span class="o">=</span> <span class="n">walker_data</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">][:]</span>
                        <span class="c1"># otherwise get only th atoms we want</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">alt_rep_data</span> <span class="o">=</span> <span class="n">walker_data</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">][</span><span class="n">alt_rep_idxs</span><span class="p">]</span>
                        <span class="n">walker_data</span><span class="p">[</span><span class="n">alt_rep_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">alt_rep_data</span>


                <span class="c1"># lastly reduce the atoms for the main representation</span>
                <span class="c1"># if this option was given</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_rep_idxs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">walker_data</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">walker_data</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">main_rep_idxs</span><span class="p">]</span>


                <span class="c1"># for all of these fields we wrap them in another</span>
                <span class="c1"># dimension to make them feature vectors</span>
                <span class="k">for</span> <span class="n">field_path</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">walker_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">walker_data</span><span class="p">[</span><span class="n">field_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">walker_data</span><span class="p">[</span><span class="n">field_path</span><span class="p">]])</span>

                <span class="c1"># save the data to the HDF5 file for this walker</span>

                <span class="c1"># check to see if the walker has a trajectory in the run</span>
                <span class="k">if</span> <span class="n">walker_idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">run_traj_idxs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">):</span>

                    <span class="c1"># if it does then append to the trajectory</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">extend_traj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="n">walker_idx</span><span class="p">,</span>
                                             <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">walker</span><span class="o">.</span><span class="n">weight</span><span class="p">]]),</span>
                                             <span class="n">data</span><span class="o">=</span><span class="n">walker_data</span><span class="p">)</span>
                <span class="c1"># start a new trajectory</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># add the traj for the walker with the data</span>

                    <span class="n">traj_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">add_traj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span>
                                                     <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">walker</span><span class="o">.</span><span class="n">weight</span><span class="p">]]),</span>
                                                     <span class="n">data</span><span class="o">=</span><span class="n">walker_data</span><span class="p">)</span>

                    <span class="c1"># add as metadata the cycle idx where this walker started</span>
                    <span class="n">traj_grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;cycle_idx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle_idx</span>


            <span class="c1"># report the boundary conditions records data, if boundary</span>
            <span class="c1"># conditions were initialized</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warping_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report_warping</span><span class="p">(</span><span class="n">cycle_idx</span><span class="p">,</span> <span class="n">warp_data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report_bc</span><span class="p">(</span><span class="n">cycle_idx</span><span class="p">,</span> <span class="n">bc_data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report_progress</span><span class="p">(</span><span class="n">cycle_idx</span><span class="p">,</span> <span class="n">progress_data</span><span class="p">)</span>

            <span class="c1"># report the resampling records data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_resampling</span><span class="p">(</span><span class="n">cycle_idx</span><span class="p">,</span> <span class="n">resampling_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_resampler</span><span class="p">(</span><span class="n">cycle_idx</span><span class="p">,</span> <span class="n">resampler_data</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


    <span class="c1"># sporadic</span>
<div class="viewcode-block" id="WepyHDF5Reporter.report_warping"><a class="viewcode-back" href="../../../api/wepy.reporter.html#wepy.reporter.hdf5.WepyHDF5Reporter.report_warping">[docs]</a>    <span class="k">def</span> <span class="nf">report_warping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="n">warping_data</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warping_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">extend_cycle_warping_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="n">warping_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="WepyHDF5Reporter.report_bc"><a class="viewcode-back" href="../../../api/wepy.reporter.html#wepy.reporter.hdf5.WepyHDF5Reporter.report_bc">[docs]</a>    <span class="k">def</span> <span class="nf">report_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="n">bc_data</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bc_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">extend_cycle_bc_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="n">bc_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="WepyHDF5Reporter.report_resampler"><a class="viewcode-back" href="../../../api/wepy.reporter.html#wepy.reporter.hdf5.WepyHDF5Reporter.report_resampler">[docs]</a>    <span class="k">def</span> <span class="nf">report_resampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="n">resampler_data</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resampler_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">extend_cycle_resampler_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="n">resampler_data</span><span class="p">)</span></div>

    <span class="c1"># the resampling records are provided every cycle but they need to</span>
    <span class="c1"># be saved as sporadic because of the variable number of walkers</span>
<div class="viewcode-block" id="WepyHDF5Reporter.report_resampling"><a class="viewcode-back" href="../../../api/wepy.reporter.html#wepy.reporter.hdf5.WepyHDF5Reporter.report_resampling">[docs]</a>    <span class="k">def</span> <span class="nf">report_resampling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="n">resampling_data</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">extend_cycle_resampling_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="n">resampling_data</span><span class="p">)</span></div>

    <span class="c1"># continual</span>
<div class="viewcode-block" id="WepyHDF5Reporter.report_progress"><a class="viewcode-back" href="../../../api/wepy.reporter.html#wepy.reporter.hdf5.WepyHDF5Reporter.report_progress">[docs]</a>    <span class="k">def</span> <span class="nf">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="n">progress_data</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wepy_h5</span><span class="o">.</span><span class="n">extend_cycle_progress_records</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wepy_run_idx</span><span class="p">,</span> <span class="n">cycle_idx</span><span class="p">,</span> <span class="p">[</span><span class="n">progress_data</span><span class="p">])</span></div></div>



</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">wepy</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/explanation.html">Explanation of Wepy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">Module Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Samuel D. Lotz.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>